/*!
 * jQuery SecureSubmit - Credit Card Tokenization Service
 * Copyright(c) 2014 Heartland Payment Systems
 *
 * https://github.com/SecureSubmit/jquery.securesubmit/blob/master/LICENSE.md
 * https://github.com/SecureSubmit/jquery.securesubmit
 */
var hps=function(e){"use strict";var t,n,r,i;t=function(e,t){this.fail=e;this.message=t};t.prototype.validate=function(){if(this.fail){i.error(this.message)}};n=function(e,t){this.message=e+" is missing";this.fail=i.empty(t[e])};r=function(t,n){this.field=t;this.type=n;this.element=typeof t==="object"?t:e("#"+t);this.message=this.element.attr("id")+" is invalid";this.fail=i.empty(this.element)||!this.element.is(this.type)};n.prototype=new t;n.prototype.constructor=n;r.prototype=new t;r.prototype.constructor=r;i={Tag:"SecureSubmit",Urls:{UAT:"https://posgateway.uat.secureexchange.net/Hps.Exchange.PosGateway.Hpf.v1/api/token",CERT:"https://posgateway.cert.secureexchange.net/Hps.Exchange.PosGateway.Hpf.v1/api/token",PROD:"https://api.heartlandportico.com/SecureSubmit.v1/api/token"},getData:function(e){return e.data(i.Tag)},setData:function(e,t){e.data(i.Tag,t)},hasData:function(e){return typeof i.getData(e)==="object"},tokenize:function(t){var n,r,s;r=e.param({api_key:t.data.public_key,object:"token",token_type:"supt",_method:"post","card[number]":e.trim(t.data.number),"card[cvc]":e.trim(t.data.cvc),"card[exp_month]":e.trim(t.data.exp_month),"card[exp_year]":e.trim(t.data.exp_year)});s=t.data.public_key.split("_")[1];if(s==="uat"){n=i.Urls.UAT}else if(s==="cert"){n=i.Urls.CERT}else{n=i.Urls.PROD}e.ajax({cache:false,url:n,data:r,dataType:"jsonp",success:function(e){if(typeof e.error==="object"){if(typeof t.error==="function"){t.error(e.error)}i.error(e.error.message)}else if(typeof t.success==="function"){t.success(e)}}})},empty:function(e){return e===undefined||e.length===0},error:function(t){e.error([i.Tag,": ",t].join(""))},configureElement:function(t){i.setData(e(this),{public_key:t.public_key,success:t.success,error:t.error,validators:[new n("public_key",t),new r("card_number","input"),new r("card_cvc","input"),new r("exp_month","input"),new r("exp_year","input")]});e(this).submit(function(t){var n,r,s;t.preventDefault();e("#card_number").removeAttr("name");e("#card_cvc").removeAttr("name");e("#exp_month").removeAttr("name");e("#exp_year").removeAttr("name");n=e(this);r=i.getData(n);for(s=0;s<r.validators.length;s+=1){r.validators[s].validate()}if(typeof n.validate==="function"){n.validate();if(!n.valid()){return}}i.tokenize({data:{public_key:r.public_key,number:e.trim(e("#card_number").val()),cvc:e.trim(e("#card_cvc").val()),exp_month:e.trim(e("#exp_month").val()),exp_year:e.trim(e("#exp_year").val())},success:function(t){e("<input>").attr({type:"hidden",id:"token_value",name:"token_value",value:t.token_value}).appendTo(n);if(typeof r.success==="function"){if(r.success(t)===false){return}}n.unbind("submit");n.submit()},error:function(e){if(typeof r.error==="function"){r.error(e)}}})})}};e.fn.SecureSubmit=function(t){return this.each(function(){if(!e(this).is("form")||typeof t!=="object"||i.hasData(e(this))){return}i.configureElement.apply(this,[t])})};return i}(jQuery)